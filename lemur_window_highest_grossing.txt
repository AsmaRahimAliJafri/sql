-- only for products in 2022
-- gross /sum  same products
-- rank products by sum in each category

-- SELECT *,
-- SUM(spend) OVER(PARTITION BY category,  product) as rank_by_product
-- FROM product_spend;

select
 *
from (
select *,
SUM(spend) OVER(PARTITION BY category, product) as total_spend
from (
select * from product_spend 
where EXTRACT(YEAR from transaction_date) = '2022') as tab_2022_products)
as end_result

